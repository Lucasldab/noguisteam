#!/usr/bin/env bash
set -euo pipefail

PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

source "$PROJECT_ROOT/lib/env.sh"
source "$PROJECT_ROOT/lib/db.sh"
source "$PROJECT_ROOT/lib/manifest.sh"
source "$PROJECT_ROOT/lib/install.sh"
source "$PROJECT_ROOT/lib/ui.sh"

result=$(run_ui) || exit 0

IFS="|" read -r action name appid <<< "$result"

case "$action" in
    I) install_game "$name" "$appid" ;;
    U) uninstall_game "$name" "$appid" ;;
    P)
        if ! pgrep -x steam >/dev/null; then
            steam -silent >/dev/null 2>&1 &
            sleep 3
        fi
        steam "steam://run/$appid" >/dev/null 2>&1 & disown
        ;;
    L)
        python3 "$PROJECT_ROOT/sync.py"
        ;;
    *)
        echo "Unknown action."
        ;;
esac

